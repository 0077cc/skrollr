(function(a,b){function s(b){var d=this;b=b||{};d.easings=q;if(b.easing){for(var e in b.easing){d.easings[e]=b.easing[e]}}d.container=a.getElementsByTagName("body")[0];d.scale=b.scale||1;d.listeners={scroll:b.scroll||c};d.skrollables=[];d.maxKeyFrame=0;var f=d.container.getElementsByTagName("*");for(var g=0;g<f.length;g++){var i=f[g];fx={},keyFrames=[],atEnd=[];for(var j=0;j<i.attributes.length;j++){var k=i.attributes[j],l=k.name.match(h),m,n;if(l!==null){m=(l[1]|0)*d.scale;n={frame:m,props:k.value};keyFrames.push(n);if(l[1]==="end"){atEnd.push(n)}if(m>this.maxKeyFrame){d.maxKeyFrame=m}}}for(var j=0;j<atEnd.length;j++){atEnd[j].frame=d.maxKeyFrame}if(keyFrames.length){keyFrames.sort(function(a,b){return a.frame-b.frame});var o={element:i,keyFrames:keyFrames};d._parseProps(o);d._fillProps(o);d.skrollables.push(o);x(i,"skrollable")}}d.dummy=a.createElement("div");var p=d.dummy.style;p.width="1px";p.height=d.maxKeyFrame+t()+"px";p.position="absolute";p.left=p.top="0px";p.zIndex="0";d.container.appendChild(d.dummy);d.onScroll=function(){var a=u();d.listeners.scroll(a);d._render(a)};d.onScroll(u());v(a,"scroll",d.onScroll);return d}var c=function(){};var d=Math;var e=parseInt;var f=parseFloat;var g=/^\s*(.*)\s$/;var h=/^data-(\d+|(?:end))$/;var i=/:|;/g;var j=/^([a-z-]+)\[(\w+)\]$/;var k=/-([a-z])/g;var l=/(?:^|\s+)((?:-|\+)?[0-9.]+)(%|px|em|ex|pt|in|cm|mm|pc|deg)?/g;var n=/((?:rotate)|(?:scale(?:X|Y)?)|(?:skew(?:X|Y)?))\((.+?)\)/g;var o=/^((?:rgba?)|(?:hsla?))\((\d{1,3})\s*,\s*(\d{1,3})%?\s*,\s*(\d{1,3})%?\s*(?:,\s*([0-9.]+))?\)$/;var p=function B(a,b){return 1-d.abs(3*d.cos(a*b*1.028)/b)};var q={begin:function(){return 0},end:function(){return 1},linear:function(a){return a},quadratic:function(a){return a*a},cubic:function(a){return a*a*a*a},swing:function(a){return-d.cos(a*d.PI)/2+.5},bounce:function(a,b){switch(true){case a<=.5083:b=3;break;case a<=.8489:b=9;break;case a<=.96208:b=27;break;case a<=.99981:b=91;break;default:return 1}return p(a,b)}};var r={constant:{step:function(a){return a}},numeric:{parser:function(a,b){l.lastIndex=0;b=l.exec(a);if(b===null){throw"Can't parse \""+a+'" as numeric value.'}return[f(b[1],10),b[2]||""]},step:function(a,c,d){if(c===b){return a[0]+a[1]}if(a[1]!==c[1]){throw"Can't interpolate between '"+val[0]+a[1]+"' and '"+a[0]+c[1]+"'"}return a[0]+(c[0]-a[0])*d+a[1]}},composedNumeric:{parser:function(a,b){b=[];for(var c=0;c<a.length;c++){b.push(r.numeric.parser(a[c]))}return b},step:function(a,c,d,e){e=[];if(c===b){for(var f=0;f<a.length;f++){e.push(r.numeric.step(a[f]))}}else{if(a.length!==c.length){throw"Can't interpolate between two composed values with different number of values."}for(var f=0;f<a.length;f++){e.push(r.numeric.step(a[f],c[f],d))}}return e.join(" ")}},transform:{parser:function(a,b,c){b=[];for(var d=0;d<a.length;d++){n.lastIndex=0;c=n.exec(a[d]);b.push(c[1]);b.push(r.numeric.parser(c[2]))}return b},step:function(a,c,d,e){e=[];if(c===b){for(var f=0;f<a.length-1;f+=2){e.push(a[f]+"("+a[f+1].join("")+")")}}else{for(var f=0;f<a.length-1;f+=2){e.push(a[f]+"("+r.numeric.step(a[f+1],c[f+1],d)+")")}}return e.join(" ")}},color:{parser:function(a){a.shift();if(a[4]===b){a[0]+="a";a[4]=1}var c="";if(a[0]==="hsla"){c="%"}a[1]=[e(a[1],10),""];a[2]=[e(a[2],10),c];a[3]=[e(a[3],10),c];a[4]=[f(a[4],10),""];return a},step:function(a,c,d){if(c===b){var f=[];for(var g=1;g<a.length;g++){f[g-1]=a[g].join("")}return a[0]+"("+f.join(",")+")"}var f=[];for(var g=1;g<4;g++){f[g-1]=e(r.numeric.step(a[g],c[g],d),10)+a[g][1]}f[3]=r.numeric.step(a[4],c[4],d);return a[0]+"("+f.join(",")+")"}}};s.prototype.setScrollTop=function(b){pageYOffset=b;a.body.scrollTop=b;a.documentElement.scrollTop=b;this.onScroll()};s.prototype._calcSteps=function(a,b){var c=a.keyFrames;if(b<c[0].frame){x(a.element,"hidden")}else if(b>c[c.length-1].frame){y(a.element,"hidden");var d=c[c.length-1],e;for(var f in d.props){if(A(d.props,f)){e=d.props[f].step(d.props[f].value);w(a.element,f,e)}}}else{y(a.element,"hidden");for(var g=0;g<c.length-1;g++){if(b>=c[g].frame&&b<=c[g+1].frame){var h,i;h=c[g];i=c[g+1];for(var f in h.props){if(A(h.props,f)){if(!A(i.props,f)){var e=h.props[f].step(h.props[f].value);w(a.element,f,e)}else{var j=(b-h.frame)/(i.frame-h.frame);j=h.props[f].easing(j);var e=h.props[f].step(h.props[f].value,i.props[f].value,j);w(a.element,f,e)}}}break}}}};s.prototype._render=function(a){for(var b=0;b<this.skrollables.length;b++){this._calcSteps(this.skrollables[b],a)}return this};s.prototype._parseProps=function(a){var b=this;for(var c=0;c<a.keyFrames.length;c++){var d=a.keyFrames[c],e=d.props.split(i),f,g,h;d.props={};for(var k=0;k<e.length-1;k+=2){f=e[k];g=e[k+1];h=f.match(j);if(h!==null){f=h[1];h=h[2]}else{h="linear"}g=b._parseProp(g);d.props[f]={value:g.value,step:g.step,easing:b.easings[h]}}}};s.prototype._parseProp=function(a){switch(false){case!(m=a.match(n)):a=r.transform.parser(m);return{value:a,step:r.transform.step};case!(m=a.match(o)):a=r.color.parser(m);return{value:a,step:r.color.step};case!(m=a.match(l)):a=r.composedNumeric.parser(m);return{value:a,step:r.composedNumeric.step};default:return{value:a,step:r.constant.step}}};s.prototype._fillProps=function(a){var b={};for(var c=0;c<a.keyFrames.length;c++){this._fillPropForFrame(a.keyFrames[c],b)}b={};for(var c=a.keyFrames.length-1;c>=0;c--){this._fillPropForFrame(a.keyFrames[c],b)}};s.prototype._fillPropForFrame=function(a,b){for(var c in b){if(!A(a.props,c)){a.props[c]=b[c]}}for(var c in a.props){b[c]=a.props[c]}};var t=function(){return a.documentElement.clientHeight};var u=function(){return pageYOffset||a.documentElement.scrollTop||a.body.scrollTop||0};var v=function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else if(elem.attachEvent){a.attachEvent("on"+b,c)}};var w=function(a,b,c){b=b.replace(k,function(a,b){return b.toUpperCase()}).replace("-","");a.style[b]=c;b=b[0].toUpperCase()+b.substr(1);for(var d=0,e=["O","Moz","webkit","ms"];d<e.length;d++){a.style[e[d]+b]=c}};var x=function(a,b){if(z(a.className).indexOf(z(b))===-1){a.className=(a.className+" "+b).replace(g,"$1")}};var y=function(a,b){a.className=z(a.className).replace(z(b),"").replace(g,"$1")};var z=function(a){return" "+a+" "};var A=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};window.skrollr={init:function(a){return new s(a)}}})(document)
