/*
 * TODO
 *	-foreach skrollabls
 *		-iterate over all keyFrames in order (small to large)
 *		-set properties from small keyFrames to large keyFrames if missing to allow starting from !== 0
 * 			Otherwise when starting from e.g. 500, and there are keyFrames for 100 and 300 we miss the values from 100
 *
 *	-Did this. Now I think it would make more sense to interpolate the frames in between.
 *	-And what about other direction (right hand)?
 */(function(a,b){function o(b){var d=this;b=b||{},d.easings=l;if(b.easing)for(var f in b.easing)d.easings[f]=b.easing[f];d.container=a.getElementsByTagName("body")[0],d.scale=b.scale||1,d.listeners={scroll:b.scroll||c},d.skrollables=[],d.maxKeyFrame=0;var g=d.container.getElementsByTagName("*");for(var h=0;h<g.length;h++){var i=g[h];fx={},keyFrames=[];for(var j=0;j<i.attributes.length;j++){var k=i.attributes[j],m=k.name.match(e);if(m!==null){var n=(m[1]|0)*d.scale;keyFrames.push({frame:n,props:k.value}),n>this.maxKeyFrame&&(d.maxKeyFrame=n)}}if(keyFrames.length){keyFrames.sort(function(a,b){return a.frame-b.frame});var o={element:i,keyFrames:keyFrames};d._parseProps(o),d._fillProps(o),d.skrollables.push(o),i.className+=" skrollable"}}d.dummy=a.createElement("div");var s=d.dummy.style;return s.width="1px",s.height=d.maxKeyFrame+p()+"px",s.position="absolute",s.left=s.top="0px",s.zIndex="0",d.container.appendChild(d.dummy),d.onScroll=function(){var a=q();d.listeners.scroll(a),d._render(a)},d.onScroll(q()),r(a,"scroll",d.onScroll),d}var c=function(){},d=Math,e=/^data-(\d+)$/,f=/:|;/g,g=/([a-z-]+)\[(\w+)\]/,h=/-([a-z])/g,i=/(?:^|\s+)((?:-|\+)?[0-9.]+)(%|px|em|ex|pt|in|cm|mm|pc|deg)?/g,j=/((?:rotate)|(?:scale(?:X|Y)?)|(?:skew(?:X|Y)?))\((.+?)\)/g,k=function(b,c){return 1-d.abs(3*d.cos(b*c*1.028)/c)},l={begin:function(){return 0},end:function(){return 1},linear:function(a){return a},quadratic:function(a){return a*a},cubic:function(a){return a*a*a*a},swing:function(a){return-d.cos(a*d.PI)/2+.5},bounce:function(a,b){switch(!0){case a<=.5083:b=3;break;case a<=.8489:b=9;break;case a<=.96208:b=27;break;case a<=.99981:b=91;break;default:return 1}return k(a,b)}},n={constant:{step:function(a){return a}},numeric:{parser:function(a,b){i.lastIndex=0,b=i.exec(a);if(b===null)throw"Can't parse \""+a+'" as numeric value.';return[parseFloat(b[1],10),b[2]||""]},step:function(a,c,d){if(c===b)return a[0]+a[1];if(a[1]!==c[1])throw"Can't interpolate between '"+val[0]+a[1]+"' and '"+a[0]+c[1]+"'";return a[0]+(c[0]-a[0])*d+a[1]}},composedNumeric:{parser:function(a,b){b=[];for(var c=0;c<a.length;c++)b.push(n.numeric.parser(a[c]));return b},step:function(a,c,d,e){e=[];if(c===b)for(var f=0;f<a.length;f++)e.push(n.numeric.step(a[f]));else{if(a.length!==c.length)throw"Can't interpolate between two composed values with different number of values.";for(var f=0;f<a.length;f++)e.push(n.numeric.step(a[f],c[f],d))}return e.join(" ")}},transform:{parser:function(a,b,c){b=[];for(var d=0;d<a.length;d++)j.lastIndex=0,c=j.exec(a[d]),b.push(c[1]),b.push(n.numeric.parser(c[2]));return b},step:function(a,c,d,e){e=[];if(c===b)for(var f=0;f<a.length-1;f+=2)e.push(a[f]+"("+a[f+1].join("")+")");else for(var f=0;f<a.length-1;f+=2)e.push(a[f]+"("+n.numeric.step(a[f+1],c[f+1],d)+")");return e.join(" ")}},color:{parser:function(a){return a},step:function(a,b,c,d){return a}}};o.prototype.setScrollTop=function(b){pageYOffset=b,a.body.scrollTop=b,a.documentElement.scrollTop=b,this.onScroll()},o.prototype._calcSteps=function(a,b){var c=a.keyFrames;if(b<c[0].frame)s(a.element,"display","none");else if(b>c[c.length-1].frame){s(a.element,"display","block");var d=c[c.length-1],e;for(var f in d.props)t(d.props,f)&&(e=d.props[f].step(d.props[f].value),s(a.element,f,e))}else{s(a.element,"display","block");for(var g=0;g<c.length-1;g++)if(b>=c[g].frame&&b<=c[g+1].frame){var h,i;h=c[g],i=c[g+1];for(var f in h.props)if(t(h.props,f))if(!t(i.props,f)){var e=h.props[f].step(h.props[f].value);s(a.element,f,e)}else{var j=(b-h.frame)/(i.frame-h.frame);j=h.props[f].easing(j);var e=h.props[f].step(h.props[f].value,i.props[f].value,j);s(a.element,f,e)}break}}},o.prototype._render=function(a){for(var b=0;b<this.skrollables.length;b++)this._calcSteps(this.skrollables[b],a);return this},o.prototype._parseProps=function(a){var b=this;for(var c=0;c<a.keyFrames.length;c++){var d=a.keyFrames[c],e=d.props.split(f),h,i,j;d.props={};for(var k=0;k<e.length-1;k+=2)h=e[k],i=e[k+1],j=h.match(g),j!==null?(h=j[1],j=j[2]):j="linear",i=b._parseProp(i),d.props[h]={value:i.value,step:i.step,easing:b.easings[j]}}},o.prototype._parseProp=function(a){switch(!1){case!(m=a.match(j)):return a=n.transform.parser(m),{value:a,step:n.transform.step};case!(m=a.match(/bbbbbbbbbbbbbbbbbbbbbb/)):break;case!(m=a.match(i)):return a=n.composedNumeric.parser(m),{value:a,step:n.composedNumeric.step};default:return{value:a,step:n.constant.step}}},o.prototype._fillProps=function(a){var b={};for(var c=0;c<a.keyFrames.length;c++)this._fillPropForFrame(a.keyFrames[c],b);b={};for(var c=a.keyFrames.length-1;c>=0;c--)this._fillPropForFrame(a.keyFrames[c],b)},o.prototype._fillPropForFrame=function(a,b){for(var c in b)t(a.props,c)||(a.props[c]=b[c]);for(var c in a.props)b[c]=a.props[c]};var p=function(){return a.documentElement.clientHeight},q=function(){return pageYOffset||a.documentElement.scrollTop||a.body.scrollTop||0},r=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):elem.attachEvent&&a.attachEvent("on"+b,c)},s=function(a,b,c){b=b.replace(h,function(a,b){return b.toUpperCase()}).replace("-",""),a.style[b]=c,b=b[0].toUpperCase()+b.substr(1);for(var d=0,e=["O","Moz","webkit","ms"];d<e.length;d++)a.style[e[d]+b]=c},t=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};window.skrollr={init:function(a){return new o(a)}}})(document);